<script lang="ts" setup>
import { reactive, ref } from "vue";
import { message } from "ant-design-vue";
import axios from "axios";
import router from "@/router";

const address = ref<string>("");
const domain = ref<string>("@naver.com");
const password1 = ref<string>("");
const password2 = ref<string>("");
const fullName = ref<string>("");

const user = reactive<User>({
  email: "",
  password: "",
  name: "",
  age: undefined,
  address: "",
  phone: "",
  avatar: "",
  hobby: [],
});

const validateEmail = () => {
  const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return emailPattern.test(address.value + domain.value);
};

const validatePassword = () => {
  const passwordPattern = /^(?=.*[A-Za-z])(?=.*\d|.*[!@#$%^&*])[A-Za-z\d!@#$%^&*]{4,16}$/;
  // const passwordPattern = /^(?=.*[A-Za-z])(?=.*\d|.*[!@#$%^&*])[A-Za-z\d!@#$%^&*]{8,16}$/;


  return passwordPattern.test(password1.value);
};





const validateForm = () => {
  if (!validateEmail()) {
    message.error("올바른 이메일 주소를 입력해주세요.");
    return false;
  }
  if (!fullName.value) {
    message.error("닉네임을 입력해주세요.");
    return false;
  }
  if (!validatePassword()) {
    message.error("비밀번호는 8~16자이며, 영문/숫자/특수문자 중 2가지 이상 포함해야 합니다.");
    return false;
  }
  if (password1.value !== password2.value) {
    message.error("비밀번호가 일치하지 않습니다.");
    return false;
  }
  return true;
};

const handleSignUp = async () => {
  if (!validateForm()) return;

  try {
    const response = await axios.post("http://13.125.143.126:5005/signup", {
      email: address.value + domain.value,
      password: password1.value,
      fullName: fullName.value,
    });
    message.success("회원가입 성공!");
    router.push("/login");
  } catch (error) {
    message.error("회원가입 실패! 다시 시도해주세요.");
  }
};
</script>

<template>
  <div class="layout">
    <div class="logo">
      <img src="/icons/SignUp/logo.svg" />
    </div>

    <div class="input-group">
      <div>
        <div>이메일 입력</div>
        <a-input-group compact>
          <a-auto-complete class="input" v-model:value="address" placeholder="Email" />
          <a-select class="input-mail" v-model:value="domain">
            <a-select-option value="naver">@naver.com</a-select-option>
            <a-select-option value="google">@google.com</a-select-option>
          </a-select>
        </a-input-group>



        <div class="input-text">닉네임 입력</div>

        <div class="components-input-demo-presuffix">
          <a-input class="input-group1" v-model:value="fullName" placeholder="닉네임을 입력해주세요">
            <template #prefix>
              <user-outlined />
            </template>

            <template #suffix>
              <a-tooltip title="Extra information">
                <info-circle-outlined style="color: rgba(0, 0, 0, 0.45)" />
              </a-tooltip>
            </template>
          </a-input>
        </div>

        <div class="input-text">비밀번호 입력</div>
        <a-input-password v-model:value="password1" placeholder="비밀번호를 입력해주세요"  />
        <div class="small-text"> 영문 대·소문자/숫자.특수문자 중 2가지 이상 조합, 8~16글자 </div>

        <div class="input-text">비밀번호 확인</div>
        <a-input-password v-model:value="password2" placeholder="비밀번호를 다시 입력해주세요" />



        <div>
          <a-button type="submit" class="button" @click="handleSignUp">회원가입</a-button>
        </div>
      </div>

      <div style="margin-left: 91.19px; margin-top: 43px;">
        <svg xmlns="http://www.w3.org/2000/svg" width="2" height="96" viewBox="0 0 2 96" fill="none">
          <path d="M1.0957 0L1.0957 96" stroke="#595959" stroke-opacity="0.5" />
        </svg>

        <div class="text">또는</div>

        <svg xmlns="http://www.w3.org/2000/svg" width="2" height="96" viewBox="0 0 2 96" fill="none">
          <path d="M1.0957 0L1.0957 96" stroke="#595959" stroke-opacity="0.5" />
        </svg>
      </div>

      <div class="social-signup">
        <img src="/icons/SignUp/kakao.svg" /> <br>
        <img style="margin-top: 11px;" src=" /icons/SignUp/naver.svg" /> <br>
        <img style="margin-top: 11px;" src="/icons/SignUp/google.svg" />
      </div>

    </div>
  </div>
</template>

<style lang="scss" scoped>
.layout {
  height: 903px;
}

.logo {
  margin-top: 48px;
  margin-left: 512px;
}

.input-group {
  margin-left: 213px;
  margin-top: 54px;
  display: flex;

  .input-text {
    margin-top: 13px
  }

  .input {
    width: 191px;
    height: 36px;
  }

  .input-mail {
    width: 132px;
    height: 36px;
  }
}

.small-text {
  color: var(--gray-6, #bfbfbf);
  font-size: 10px
}

.button {
  width: 100px;
  margin-left: 220px;
  margin-top: 20px;
  background-color: #6472fc;
}

.text {
  color: rgba(25, 25, 25, 0.50);
  font-size: 14px;
  font-style: normal;
  margin-left: -10px;
}

.social-signup {
  margin-top: 60px;
  margin-left: 87.9px;
}

.text-error {
  color: red;
}

.text-success {
  color: green;
}
</style>
